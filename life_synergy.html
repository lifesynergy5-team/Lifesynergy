<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShramArogya</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom fade-in animation */
    .animate-fade-in {
      animation: fade-in 0.3s ease-out forwards;
    }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Add a clean scrollbar style */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 4px;
    }
  </style>
</head>
<body class="min-h-screen bg-slate-100 text-slate-900 p-4 sm:p-6 font-sans">

  <header class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between py-4 border-b-2 border-slate-300">
    <div class="flex items-center gap-4">
      <div class="w-14 h-14 rounded-full bg-blue-900 flex items-center justify-center text-white font-bold text-2xl shadow-md border-2 border-white">
        SA
      </div>
      <div>
        <h1 class="text-2xl font-bold text-blue-900">ShramArogya</h1>
        <p class="text-sm text-slate-600">Worker Health & Wellness Portal</p>
      </div>
    </div>
    <nav class="flex gap-2 sm:gap-4 items-center mt-4 sm:mt-0">
      <button class="px-4 py-2 rounded-md bg-blue-800 text-white text-sm font-semibold shadow-sm hover:bg-blue-900 transition-colors">Portal</button>
      <button class="px-4 py-2 rounded-md border border-slate-400 text-sm font-semibold text-slate-700 hover:bg-slate-200 transition-colors">Guidelines</button>
      <button class="px-4 py-2 rounded-md border border-slate-400 text-sm font-semibold text-slate-700 hover:bg-slate-200 transition-colors">Login</button>
    </nav>
  </header>

  <main class="max-w-7xl mx-auto mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
    <section class="lg:col-span-7 bg-white p-6 rounded-lg shadow-md border border-slate-200">
      <h2 class="text-3xl font-bold text-slate-800">Health & Wellness Record Portal</h2>
      <p class="mt-2 text-slate-600">
        A unified platform to register, track, and monitor health data for migrant workers, ensuring continuity of care.
      </p>

      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
          <h3 class="font-semibold text-blue-900">Key Actions</h3>
          <ul class="mt-2 text-sm text-slate-600 list-disc list-inside space-y-1">
            <li>Register New Worker</li>
            <li>Conduct Health Scan</li>
            <li>Fetch Record via QR</li>
          </ul>
        </div>

        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
          <h3 class="font-semibold text-blue-900">System Information</h3>
          <p class="mt-2 text-sm text-slate-600">
            Total Records: <b id="totalRecords" class="text-slate-800">0</b> workers
          </p>
          <p class="text-sm text-slate-600 flex items-center gap-2">AI Module: <span class="text-green-600 font-bold">Operational</span></p>
        </div>
      </div>

      <form id="migrantForm" class="mt-8 pt-6 border-t border-slate-200 flex flex-col gap-4">
        <h3 class="text-xl font-semibold text-slate-700">New Worker Registration</h3>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <input name="name" placeholder="Full Name" class="p-2 border border-slate-300 rounded-md w-full focus:ring-2 focus:ring-blue-800" required />
          <input name="age" placeholder="Age" class="p-2 border border-slate-300 rounded-md w-full focus:ring-2 focus:ring-blue-800" type="number" min="0" required />
          <input name="state" placeholder="Home State" class="p-2 border border-slate-300 rounded-md w-full focus:ring-2 focus:ring-blue-800" required />
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <input name="vaccine" placeholder="Vaccination Status" class="p-2 border border-slate-300 rounded-md w-full focus:ring-2 focus:ring-blue-800" />
          <input name="chronic" placeholder="Chronic Conditions" class="p-2 border border-slate-300 rounded-md w-full focus:ring-2 focus:ring-blue-800" />
          <input name="lastVisit" class="p-2 border border-slate-300 rounded-md w-full focus:ring-2 focus:ring-blue-800 text-slate-500" type="date" />
        </div>
        <div class="flex gap-3 items-center">
          <button type="submit" class="px-6 py-2 rounded-md bg-blue-800 text-white font-semibold shadow-sm hover:bg-blue-900 transition-colors">
            Add Record
          </button>
          <button type="button" id="loadSampleBtn" class="px-6 py-2 rounded-md border border-slate-400 text-slate-700 font-semibold hover:bg-slate-200 transition-colors">
            Load Sample
          </button>
        </div>
      </form>

      <div class="mt-8 pt-6 border-t border-slate-200">
        <h3 class="text-xl font-semibold text-slate-700">Registered Workers</h3>
        <div id="migrantList" class="mt-3 grid gap-3 max-h-64 overflow-auto pr-2"></div>
      </div>
    </section>

    <aside class="lg:col-span-5 space-y-6">
      <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
        <h3 class="text-xl font-bold text-slate-800">Dashboard Summary</h3>
        <p class="text-sm text-slate-500 mt-1">Health overview of all registered workers.</p>
        <div class="mt-4 grid grid-cols-3 gap-4 text-center">
          <div>
            <div id="total" class="text-4xl font-bold text-blue-900">0</div>
            <div class="text-sm text-slate-500">Total Records</div>
          </div>
          <div>
            <div id="vaccinated" class="text-4xl font-bold text-blue-900">0</div>
            <div class="text-sm text-slate-500">Vaccinated</div>
          </div>
          <div>
            <div id="chronic" class="text-4xl font-bold text-teal-600">0</div>
            <div class="text-sm text-slate-500">Chronic Illness</div>
          </div>
        </div>
        <div class="mt-6 pt-6 border-t border-slate-200">
          <div id="summaryRings" class="flex gap-6 items-center justify-center sm:justify-start"></div>
        </div>
      </div>

      <div id="migrantDetails" class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hidden animate-fade-in">
        <h3 class="text-xl font-bold text-slate-800">Worker Health Record</h3>
        <div id="detailsContent" class="mt-4 pt-4 border-t border-slate-200 grid grid-cols-2 gap-x-4 gap-y-3 text-sm"></div>
        <button id="closeDetailsBtn" class="mt-6 w-full px-4 py-2 rounded-md bg-slate-600 text-white text-sm font-semibold hover:bg-slate-700 transition-colors">
          Close Record
        </button>
      </div>
    </aside>
  </main>

  <script>
    // --- State and Data Management ---
    let migrants = [];
    let selectedMigrant = null;
    let aiEstimateLoading = false;

    // --- DOM Elements ---
    const migrantForm = document.getElementById("migrantForm");
    const migrantListContainer = document.getElementById("migrantList");
    const totalRecordsEl = document.getElementById("totalRecords");
    const vaccinatedEl = document.getElementById("vaccinated");
    const chronicEl = document.getElementById("chronic");
    const summaryRingsEl = document.getElementById("summaryRings");
    const migrantDetailsEl = document.getElementById("migrantDetails");
    const detailsContentEl = document.getElementById("detailsContent");
    const loadSampleBtn = document.getElementById("loadSampleBtn");
    const closeDetailsBtn = document.getElementById("closeDetailsBtn");

    // --- Core Functions ---
    function updateDashboardSummary() {
      const vaccinatedCount = migrants.filter(m => m.vaccine && m.vaccine !== "None" && m.vaccine !== "No").length;
      const chronicCount = migrants.filter(m => m.chronic && m.chronic !== "No" && m.chronic !== "None").length;
      const totalCount = migrants.length;

      totalRecordsEl.textContent = totalCount;
      vaccinatedEl.textContent = vaccinatedCount;
      chronicEl.textContent = chronicCount;

      renderSummaryRings(vaccinatedCount, chronicCount, totalCount);
    }

    function renderSummaryRings(vaccinated, chronic, total) {
      const vacPct = total > 0 ? Math.round((vaccinated / total) * 100) : 0;
      const chrPct = total > 0 ? Math.round((chronic / total) * 100) : 0;

      summaryRingsEl.innerHTML = `
        <div class="text-center">
          <svg width="120" height="120" viewBox="0 0 36 36" class="transform -rotate-90">
            <circle cx="18" cy="18" r="15.9155" fill="none" stroke="#e0e0e0" stroke-width="3" />
            <circle cx="18" cy="18" r="15.9155" fill="none" stroke="#1e3a8a" stroke-width="3" stroke-linecap="round" stroke-dasharray="${vacPct} 100" class="transition-all duration-700" />
            <text x="18" y="20" text-anchor="middle" font-size="5" fill="#333" class="transform rotate-90" dy="1">${vacPct}%</text>
          </svg>
          <p class="text-sm font-medium mt-1 text-slate-700">Vaccinated</p>
        </div>
        <div class="text-center">
          <svg width="120" height="120" viewBox="0 0 36 36" class="transform -rotate-90">
            <circle cx="18" cy="18" r="15.9155" fill="none" stroke="#e0e0e0" stroke-width="3" />
            <circle cx="18" cy="18" r="15.9155" fill="none" stroke="#4fd1c5" stroke-width="3" stroke-linecap="round" stroke-dasharray="${chrPct} 100" class="transition-all duration-700" />
            <text x="18" y="20" text-anchor="middle" font-size="5" fill="#333" class="transform rotate-90" dy="1">${chrPct}%</text>
          </svg>
          <p class="text-sm font-medium mt-1 text-slate-700">Chronic Illness</p>
        </div>
      `;
    }

    function renderMigrantList() {
      migrantListContainer.innerHTML = "";
      migrants.forEach(migrant => {
        const migrantDiv = document.createElement("div");
        migrantDiv.className = `p-3 rounded-lg border flex flex-col sm:flex-row justify-between items-start sm:items-center transition-colors ${selectedMigrant && selectedMigrant.id === migrant.id ? "bg-blue-50 border-blue-400" : "bg-white hover:bg-slate-50 border-slate-300"}`;
        migrantDiv.innerHTML = `
          <div>
            <div class="font-semibold text-slate-800">
              ${migrant.name} <span class="text-sm text-slate-500 font-mono">(${migrant.id})</span>
            </div>
            <div class="text-sm text-slate-500 mt-1">
              From: ${migrant.state} • Last Visit: ${migrant.lastVisit || "N/A"}
            </div>
          </div>
          <div class="flex gap-2 mt-3 sm:mt-0 self-start sm:self-center">
            <button class="view-btn px-3 py-1 rounded-md border text-sm font-medium bg-white hover:bg-slate-100 border-slate-400 transition-colors">View</button>
            <button class="ai-estimate-btn px-3 py-1 rounded-md bg-teal-500 text-white text-sm font-medium hover:bg-teal-600 transition-colors" title="${aiEstimateLoading ? "Estimating..." : "AI Health Estimate"}" >
              ${aiEstimateLoading ? "..." : "AI Est."}
            </button>
            <button class="export-btn px-3 py-1 rounded-md bg-slate-200 text-sm font-medium hover:bg-slate-300 transition-colors">Export</button>
          </div>
        `;
        migrantDiv.querySelector(".view-btn").addEventListener("click", () => showMigrantDetails(migrant));
        migrantDiv.querySelector(".ai-estimate-btn").addEventListener("click", () => simulateAIEstimate(migrant.id));
        migrantDiv.querySelector(".export-btn").addEventListener("click", () => exportReport(migrant));
        migrantListContainer.appendChild(migrantDiv);
      });
    }

    function showMigrantDetails(migrant) {
      selectedMigrant = migrant;
      migrantDetailsEl.classList.remove("hidden");
      detailsContentEl.innerHTML = `
        <p class="text-slate-500">Name:</p><p class="font-semibold text-slate-800">${migrant.name}</p>
        <p class="text-slate-500">ID:</p><p class="font-semibold text-slate-800 font-mono">${migrant.id}</p>
        <p class="text-slate-500">Age:</p><p class="font-semibold text-slate-800">${migrant.age}</p>
        <p class="text-slate-500">State:</p><p class="font-semibold text-slate-800">${migrant.state}</p>
        <p class="text-slate-500">Vaccine Status:</p><p class="font-semibold text-slate-800">${migrant.vaccine || "N/A"}</p>
        <p class="text-slate-500">Chronic Conditions:</p><p class="font-semibold text-slate-800">${migrant.chronic || "N/A"}</p>
        <p class="text-slate-500">Last Clinic Visit:</p><p class="font-semibold text-slate-800">${migrant.lastVisit}</p>
        <p class="text-slate-500">AI Health Risk:</p>
        <p class="font-bold ${migrant.riskScore > 60 ? 'text-red-500' : 'text-green-600'}">
          ${migrant.riskScore !== undefined ? `${migrant.riskScore}%` : "Not estimated"}
        </p>
      `;
      renderMigrantList();
    }

    function closeMigrantDetails() {
      selectedMigrant = null;
      migrantDetailsEl.classList.add("hidden");
      renderMigrantList();
    }

    function addMigrant(event) {
      event.preventDefault();
      const newMigrant = {
        id: `M-${Math.floor(Math.random() * 900 + 100)}`,
        name: event.target.name.value,
        age: event.target.age.value,
        state: event.target.state.value,
        vaccine: event.target.vaccine.value,
        chronic: event.target.chronic.value,
        lastVisit: event.target.lastVisit.value,
      };
      migrants.unshift(newMigrant);
      migrantForm.reset();
      renderAll();
    }

    function simulateAIEstimate(migrantId) {
      aiEstimateLoading = true;
      renderMigrantList();
      setTimeout(() => {
        migrants = migrants.map(m => (m.id === migrantId ? { ...m, riskScore: Math.round(Math.random() * 100) } : m));
        aiEstimateLoading = false;
        renderMigrantList();
        if (selectedMigrant && selectedMigrant.id === migrantId) {
          showMigrantDetails(migrants.find(m => m.id === migrantId));
        }
      }, 900);
    }

    function exportReport(migrant) {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(migrant, null, 2));
      const downloadAnchorNode = document.createElement('a');
      downloadAnchorNode.setAttribute("href", dataStr);
      downloadAnchorNode.setAttribute("download", `${migrant.id}_report.json`);
      document.body.appendChild(downloadAnchorNode);
      downloadAnchorNode.click();
      downloadAnchorNode.remove();
    }

    function loadSampleData() {
        migrants = [
            { id: "M-001", name: "Ravi Kumar", age: 28, state: "Bihar", vaccine: "TT 2", chronic: "No", lastVisit: "2024-09-01" },
            { id: "M-002", name: "Fatima Sheikh", age: 33, state: "West Bengal", vaccine: "TT 1", chronic: "Asthma", lastVisit: "2024-08-10" }
        ];
        renderAll();
    }

    function renderAll() {
      renderMigrantList();
      updateDashboardSummary();
    }

    // --- Event Listeners ---
    migrantForm.addEventListener("submit", addMigrant);
    loadSampleBtn.addEventListener("click", loadSampleData);
    closeDetailsBtn.addEventListener("click", closeMigrantDetails);

    // Initial render with initial data
    loadSampleData();
  </script>
</body>
</html>
